{% extends 'base.html' %}
{% block content %}

<meta http-equiv="refresh" content="300; url = /secrets" />
<div class="container my-3">
    <h3 align="center">Two-Factor Authentication</h3>
    <div class="form-group">
        <label for="secret">Secret Token</label>
        <input type="text" class="form-control" id="SECRET" name="SECRET" value="{{ secret[0] }}" readonly />
        <input type="hidden" id="URL" name="URL" value="{{ secret[1] }}" />
    </div>
    <div class="my-2">
        <ul>
            <li>Download an authenticator app like <a href="https://getaegis.app/" target="_blank" rel="noopener noreferrer"> Aegis Authenticator</a>.</li>
            <li>Scan the QR Code or enter the key manually.</li>
            <li>Enter the generated OTP to activate 2FA</li>
        </ul>
    </div>
    <canvas class="my-2" id="qr"></canvas>

    <script src="/static/JavaScript/qrious.min.js"></script>
    <script>
        (function () {
            var qr = new QRious({
                element: document.getElementById("qr"),
                value: document.getElementById("URL").value,
                size: 250,
            });
        })();
    </script>
    <h3>Enter OTP to enable 2FA</h3>
    <form action="/two-FA" method="POST">
        <div class="form-group mb-3">
            <label for="PASSWORD">Password</label>
            <input type="password" class="form-control" name="PASSWORD" id="PASSWORD" placeholder="Password" />
        </div>
        <div class="mb-3">
            <label for="OTP" class="form-label">OTP</label>
            <input autofocus="autofocus" type="text" class="form-control" name="OTP" id="OTP" aria-describedby="emailHelp" placeholder="Enter otp generated by your app." />
        </div>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <input type="hidden" name="SECRET" value="{{ secret[0] }}" required />
        <button id="otp-sub" type="submit" class="btn btn-primary">Submit OTP</button>
        <div class="alert alert-primary my-3" role="alert">
            Greetings, Traveller!
        </div>
    </form>
    <!-- JINJA to display flashed messages -->
	<div class="my-3">
		{% with messages = get_flashed_messages(with_categories=true) %}
			{% if messages %}
				{% for category, message in messages %}
					{% if category == 'error' %}
						<div class="alert alert-danger" role="alert">
						{{ message }}
						</div>
					{% else %}
						<div class="alert alert-success" role="alert">
						{{ message }}
						</div>
					{% endif %}
				{% endfor %}
			{% endif %}
		{% endwith %}
	</div>
</div>

<!-- Allows re-loading of page without the prompt to re-submit data(Search-Query) -->
<script>
    if (window.history.replaceState) {
        window.history.replaceState(null, null, window.location.href);
    }
</script>

<!-- Enabling Dark Mode -->
<style>
    .container {
        color: #fff !important;
    }
</style>

{% endblock content %}